<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Messenger</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  body { margin:0; font-family: Arial, sans-serif; background: #f5f5f5; }
  /* Header */
  .header {
    display: flex; justify-content: space-between; align-items: center;
    background: #a67c52; color: white; padding: 12px;
    position: fixed; top:0; left:0; right:0; z-index:1000;
  }
  .header h2 { margin:0; font-size: 20px; }
  .header-icons i { margin-left: 15px; cursor: pointer; }

  /* Content */
  .content { padding: 70px 10px 70px; }

  /* Bottom Nav */
  .bottom-nav {
    display: flex; justify-content: space-around; align-items: center;
    background: #fff; border-top: 1px solid #ccc;
    position: fixed; bottom:0; left:0; right:0; height: 60px;
  }
  .bottom-nav i { font-size: 22px; color: #a67c52; }
  .bottom-nav .active i { color: #ff6600; }
</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <h2>Messenger</h2>
  <div class="header-icons">
    <i class="fas fa-search"></i>
    <i class="fas fa-bell"></i>
  </div>
</div>

<!-- Content -->
<div class="content" id="chatList">
  <!-- Friend list / chat list will appear here -->
  <p>Loading chats...</p>
</div>

<!-- Bottom Navigation -->
<div class="bottom-nav">
  <div class="active"><i class="fas fa-comments"></i></div>
  <div><i class="fas fa-bell"></i></div>
  <div><i class="fas fa-file-alt"></i></div>
  <div><i class="fas fa-book"></i></div>
  <div><i class="fas fa-user"></i></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyBVPv24bcX6aLD3colMIP_tPkomhW1hotE",
  authDomain: "darpanbook.firebaseapp.com",
  databaseURL: "https://darpanbook-default-rtdb.firebaseio.com",
  projectId: "darpanbook",
  storageBucket: "darpanbook.appspot.com",
  messagingSenderId: "791059696742",
  appId: "1:791059696742:web:0bf51e375feaa0545a31a7"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

auth.onAuthStateChanged(user => {
  if (!user) {
    window.location.href = "index.html";
  } else {
    loadChats(user.uid);
  }
});

function loadChats(uid) {
  const chatList = document.getElementById("chatList");
  db.ref("friends/" + uid).on("value", snap => {
    chatList.innerHTML = "";
    if (!snap.exists()) {
      chatList.innerHTML = "<p>No friends yet</p>";
      return;
    }
    snap.forEach(child => {
      const friendId = child.key;
      db.ref("users/" + friendId).once("value").then(userSnap => {
        const friendData = userSnap.val();
        const div = document.createElement("div");
        div.style.padding = "10px";
        div.style.borderBottom = "1px solid #ccc";
        div.innerHTML = `<strong>${friendData.name}</strong> - ${friendData.email}`;
        div.onclick = () => openChat(friendId);
        chatList.appendChild(div);
      });
    });
  });
}

function openChat(friendId) {
  window.location.href = "chat.html?friendId=" + friendId;
}
</script>
</body>
</html>
